{% extends 'accounting/_list_base.html' %}
{% load static %}

{% block title %}Chart of Accounts{% endblock %}
{% block breadcrumb %}Chart of Accounts{% endblock %}
{% block add_url %}{{ create_url }}{% endblock %}

{% block list_header %}
<h4 class="card-title">Chart of Accounts</h4>
{% endblock %}

{% block create_button %}
<a href="{{ create_url }}" class="btn btn-success mb-2">
    <i class="mdi mdi-plus me-1"></i> New Chart of Account
</a>
{% endblock %}

{% block table_head %}
<thead>
  <tr>
    <th>Account Code</th>
    <th>Account Name</th>
    <th>Type</th>
    <th>Active</th>
    <th>Archived</th>
    <th>Display Order</th>
    <th>Currency</th>
    <th>Opening Balance</th>
    <th>Current Balance</th>
    <th>Reconciled Balance</th>
    <th>Last Reconciled</th>
    <th>Manual Journal</th>
    <th>Account Level</th>
    <th>Tree Path</th>
    <th>Parent Account</th>
    <th>Action</th>
  </tr>
</thead>
{% endblock %}

{% block table_body %}
<tbody>
  {% for account in accounts %}
  <tr>
    <td>{{ account.account_code }}</td>
    <td>{{ account.account_name }}</td>
    <td>{{ account.account_type.name }}</td>
    <td>{% if account.is_active %}<span class="badge bg-success">Active</span>{% else %}<span class="badge bg-danger">Inactive</span>{% endif %}</td>
    <td>{% if account.is_archived %}Yes{% else %}No{% endif %}</td>
    <td>{{ account.display_order }}</td>
    <td>{{ account.currency }}</td>
    <td>{{ account.opening_balance }}</td>
    <td>{{ account.current_balance }}</td>
    <td>{{ account.reconciled_balance }}</td>
    <td>{{ account.last_reconciled_date }}</td>
    <td>{% if account.allow_manual_journal %}Yes{% else %}No{% endif %}</td>
    <td>{{ account.account_level }}</td>
    <td>{{ account.tree_path }}</td>
    <td>{% if account.parent_account %}{{ account.parent_account.account_code }}{% endif %}</td>
    <td>
      {% if perms.accounting.change_chartofaccount %}
        <a href="{% url 'accounting:chart_of_accounts_update' account.pk %}" class="btn btn-sm btn-primary" title="Edit this account">
          <i class="fas fa-edit"></i> Edit
        </a>
      {% else %}
        <button class="btn btn-sm btn-primary" title="No permission to edit" disabled>Edit</button>
      {% endif %}
      {% if perms.accounting.delete_chartofaccount %}
        <a href="{% url 'accounting:chart_of_accounts_delete' account.pk %}" class="btn btn-sm btn-danger ms-1" title="Delete this account">
          <i class="fas fa-trash"></i> Delete
        </a>
      {% else %}
        <button class="btn btn-sm btn-danger ms-1" title="No permission to delete" disabled>Delete</button>
      {% endif %}
    </td>
  </tr>
  {% empty %}
  <tr><td colspan="16" class="text-center">No chart of accounts found.</td></tr>
  {% endfor %}
  <!-- {% include "accounting/partials/chart_of_accounts_tree.html" with accounts=account_tree level=0 %} -->
</tbody>
{% endblock %}

